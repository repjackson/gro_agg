template(name='user_dashboard')
    // +user_about
    // .ui.hidden.divider
    .ui.stackable.grid
        .row
            .sixteen.wide.column
                .ui.inline.header #{points}pts
                .ui.big.basic.circular.label {{to_percent one_ratio}}% one ratio
                .ui.large.basic.circular.label #{flow_volume} volume
                //- .ui.compact.icon.button.refresh_user_stats(title='refresh stats')
                //-     i.refresh.icon
                if online 
                    .ui.green.large.label 
                        i.large.checkmark.icon
                        |online
                else
                    .ui.disabled.large.label 
                        |offline
                if current_status
                    .ui.small.header(title='status' )
                        i.grey.clock.icon
                        |!{current_status}
                if is_dev
                    .ui.small.inline.header #{_id}
        .four.column.row
            .column
                a.ui.inline.header(href="/user/#{username}/credits")
                    i.chevron.down.large.icon
                    |#{total_credit_amount}p
                    // |received
                    small(title='received count') (#{credit_count}x) 
                    small(title='rank') ##{global_credit_count_rank}
                i.tags.icon(title='credit tags')
                each credit_tags
                    .ui.small.basic.circular.label #{title}
                        // small #{count}
                .medscroll.ui.segments
                    each user_credits
                        +user_credit_segment
            .column
                a.ui.inline.spaced.header(href="/user/#{username}/debits")
                    i.chevron.up.icon
                    |#{total_debit_amount}p
                    // |sent
                    small(title='debit count') (#{debit_count}x)
                    small(title='rank') ##{global_debit_count_rank}
                i.tags.icon(title='credit tags')
                each debit_tags
                    .ui.small.basic.circular.label #{title} 
                        // small #{count}
    
                div
                .medscroll.ui.segments
                    each user_debits
                        +user_debit_segment
            .column
                a.ui.inline.spaced.header(href="/user/#{username}/requests")
                    i.concierge.bell.icon
                    |requests
                .ui.small.header (#{total_fulfilled_amount}p total fulfilled)
                .ui.small.header (#{fulfilled_count}p total fulfilled count)
                .medscroll
                    each user_requests
                        .ui.card
                            if image_id
                                img.ui.image(src="{{c.url image_id height=100 width=200}}" class=currentUser.invert_class)
                            .content.zoom.pointer
                                a.header(href="/request/#{_id}/view")
                                    |#{point_bounty}pts: #{title}
                                // |!{description}
                                |status: #{status}
                                if complete 
                                    |completed by #{completer.name}
            .column
                a.ui.inline.spaced.header(href="/user/#{username}/events")
                    i.calendar.icon
                    |events
                .medscroll
                    each user_event_tickets
                        .ui.card
                            if ticket_event.image_id
                                a(href="/event/#{event_id}/view")
                                    img.ui.fluid.zoom.image(src="{{c.url ticket_event.image_id height=200 width=200 crop='fit'}}" class=currentUser.invert_class)
                            .content.zoom.pointer
                                a.header(href="/event/#{event_id}/view")
                                    |#{ticket_event.title}
                                |#{fac.shortname}
                                |#{description}
                                |{{med_date date}}
                                |{{long_time time}}
        .ui.stackable.padded.grid
            .five.wide.column
                .ui.segment 
                    |Average rating
                    .ui.big.center.aligned.header
                        i.yellow.star.icon
                        |4.90
                    |based on 80 online reviews
                    // if background_checked
                    .ui.list
                        .item
                            i.users.icon
                            |Owner Background Checked  
                        .item No neighbor data for this pro
                        .item
                            i.calendar.icon
                            |1 year in business
                        .item
                            i.home.icon
                            |Typical home value is unknown
                        .item
                            i.tasks.icon
                            |Median project cost is unknown
                        .item
                            i.clock.icon
                            |Response rate is unknown
            .five.wide.column
                .ui.segment 
                    .ui.header Professional information
                    .ui.small.header address
                    .ui.small.header phone
            .four.wide.column
                .ui.segment 
                    .ui.header mode
                    +boolean_edit key='edit_mode' label='edit mode' direct=true
            .eight.wide.column
                .ui.segment 
                    .ui.header Reviews
                    each reviews 
                        .ui.header #{title}
            .eight.wide.column
                .ui.segment 
                    .ui.header Projects
                    each projects 
                        .ui.header #{title}
            .eight.wide.column
                .ui.segment 
                    .ui.header Service Area
                    if is_current_user
                        if currentUser.edit_mode
                            +array_edit key='service_area_codes' label='service area codes' direct=true
                    each service_area_codes 
                        .ui.header #{this}
                



template(name='user_credit_segment')
    .ui.segment.user_credit_segment.pointer.zoom
        .header
            strong #{amount}pt 
            // |from 
            if author.profile_image_id
                img.ui.avatar.image(src="{{c.url author.profile_image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
            |#{_author.shortname}
        small #{when}
        div
        |#{description}
        div
        each tags
            .ui.mini.basic.label #{this}


template(name='user_debit_segment')
    .ui.segment.user_debit_segment.pointer.zoom
        .header
            strong #{amount}pt
            | to 
            if recipient.profile_image_id
                img.ui.avatar.image(src="{{c.url recipient.profile_image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
            |#{recipient.shortname}
        small #{when}
        div
        |#{description}
        div
        each tags
            .ui.mini.basic.label #{this}
            
            
            